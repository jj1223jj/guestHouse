<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="host.dao.mapper">
  <insert id="subImgUpload" parameterType="com.java.file.dto.FileDto">
  	 insert into FileList(fileCode, fileName, filePath, fileSize, houseCode) values(seq_fileList_num.nextval, #{fileName}, #{filePath}, #{fileSize}, #{houseCode})
  </insert>
  
  <update id="memberProfileUpdate" parameterType="java.util.Map">
  	update member set MemberImgSize = #{memberImgSize}, MemberImgName = #{memberImgName}, MemberImgPath = #{memberImgPath}, MemberInfo = #{memberInfo} where email = #{email}
  </update>
  
  <select id="memberCode" parameterType="String" resultType="int">
  	select memberCode from member where email = #{email}
  </select>
  
  <insert id="hostRegister" parameterType="com.java.host.dto.HostDto">
  	insert into house(houseCode, memberCode, houseName,explain,bath,etc,checkInTime,checkOutTime,necessary,wifi,washer,hotWater,aircon,
  	tv,mart,parking,kitchen,safety,address,sido,sigungu,roadName,bName,jibunAddress,latLng,detailAddress,local,approvalStatus,
  	bank,account,people,bed,price,houseRegDate)
  	 values(seq_house_num.nextval, #{memberCode},#{houseName},
  	#{explain},#{bath},#{etc},#{checkInTime},
  	#{checkOutTime},#{necessary, jdbcType=VARCHAR},#{wifi, jdbcType=VARCHAR},#{washer, jdbcType=VARCHAR},#{hotWater, jdbcType=VARCHAR},#{aircon, jdbcType=VARCHAR},#{tv, jdbcType=VARCHAR},#{mart, jdbcType=VARCHAR},
  	#{parking, jdbcType=VARCHAR},#{kitchen, jdbcType=VARCHAR},#{safety, jdbcType=VARCHAR},#{address}, #{sido}, #{sigungu}, #{roadName}, #{bName},
  	 #{jibunAddress}, #{latLng}, #{detailAddress}, #{local}, #{approvalStatus}, #{bank}, 
  	 #{account}, #{people}, #{bed}, #{price}, #{houseRegDate})
  </insert>
  
  <insert id="mainImgUpload" parameterType="com.java.file.dto.FileDto">
  	 insert into FileList(fileCode, mainImgName, filePath, fileSize, houseCode) values(seq_fileList_num.nextval, #{mainImgName}, #{filePath}, #{fileSize}, #{houseCode})
  </insert>
  
  <select id="houseCode" resultType="int">
  	select max(houseCode) from house
  </select>
  
  <select id="houseList" parameterType="java.util.Map" resultType="com.java.host.dto.HostDto">
  <![CDATA[
  	select * from
	(select rownum rnum, A.* from
	(select * from house where memberCode = #{memberCode})A)
	where rnum>=#{startRow} and rnum<=#{endRow}
	]]>
  </select>
  
  <update id="hostCancel" parameterType="int">
  	update house set approvalStatus = '삭제' where housecode = #{houseCode}
  </update>
  
  <select id="houseNameList" parameterType="int" resultType="String">
  	select houseName from house where memberCode = #{memberCode} and approvalStatus = '승인완료'
  </select>
  
  <select id="getHouseCode" parameterType="String" resultType="int">
  	select houseCode from house where houseName = #{houseName}
  </select>
  
  <select id="reserveViewList" parameterType="java.util.Map" resultType="com.java.host.dto.ReservationListDto">
  	<![CDATA[
  	select * from (select rownum rnum, A.*From (select member.memberName, member.email, member.phone, reservation.checkIn, reservation.checkOut, reservation.payment, reservation.state from member natural join reservation where reservation.housecode = #{houseCode})A) WHERE rnum>=#{startRow} and rnum<=#{endRow}
  	]]>
  </select>
  
  <select id="getHouseCount" parameterType="String" resultType="int">
  	select count(*) from house natural join member where email = #{email}
  </select>
  
  <select id="getReserveCount" parameterType="int" resultType="int">
  	select count(*) from reservation where houseCode = #{houseCode}
  </select>
  
   <select id="getExCount" parameterType="int" resultType="int">
  	select count(*) from experience where memberCode = #{memberCode}
  </select>
  
  <select id="experienceList" parameterType="java.util.Map" resultType="com.java.experience.dto.ExperienceDto">
  	<![CDATA[
  	select * from
	(select rownum rnum, A.* from
	(select * from experience
	where memberCode = #{memberCode})A)
	where rnum>=#{startRow} and rnum<=#{endRow}
  	]]>
  </select>
  
  <select id="getSales" parameterType="int" resultType="com.java.guestReserve.dto.GuestReserveDto">
  	<!-- select TO_CHAR(reserveDate, 'yyyy-mm'), payment from reservation where memberCode = #{memberCode} -->
  	select reservation.reserveDate, reservation.payment from house, reservation where house.memberCode = #{memberCode} and house.houseCode = reservation.houseCode and reservation.state = '완료'
  </select>
  
  <select id="getSearchDateCount" parameterType="java.util.Map" resultType="int">
  	select count(*) from house, reservation, member where house.memberCode = #{memberCode} and member.memberCode = reservation.memberCode and house.houseCode = reservation.houseCode and reservation.state = '완료' and reservation.reserveDate between #{startDate} and #{endDate}
  </select>
  
  <select id="searchDateList" parameterType="java.util.Map" resultType="com.java.host.dto.SearchDateList">
  	<![CDATA[
  		select * from
		(select rownum rnum, A.* from
		(select reservation.reserveDate, member.memberName, reservation.people, reservation.payment  from house, reservation, member where house.memberCode = 21 and member.memberCode = reservation.memberCode and house.houseCode = reservation.houseCode and reservation.state = '완료' and reservation.reserveDate between #{startDate} and #{endDate})A)
		 WHERE rnum>=#{startRow} and rnum<=#{endRow}
  	]]>
  </select>
  
</mapper>